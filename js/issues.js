function requestIssuesAPI(e,s,t){let i=10;!function n(){return new Promise((a,l)=>{let o=0,r=setTimeout(()=>{0===o&&(o=2,r=null,l("请求超时"),0==i&&t())},5e3);fetch(e).then(function(e){if(2!==o&&(clearTimeout(r),a(e),r=null,o=1),e.ok)return e.json();throw new Error("Network response was not ok.")}).then(function(e){i=0,s(e)}).catch(function(e){i>0?(i-=1,setTimeout(()=>{n()},5e3)):t()})})}()}function parseIssueStrToJson(e){let s=e.match(/```json[\s|\S]*```/);if(s&&s.length>0&&(s=s[0]),s&&(s=s.split("```json")[1].split("```")[0]))return JSON.parse(s)}function groupIssuesData(e,s){var t=new Object;if(s.length>0)if(void 0!=e.group){let a=e.group.split(":");if(a.length>1){let l=a[0],o=a[1];for(l&&o&&(o=o.split(",")),e.group=o,i=0;i<s.length;i++){let e=parseIssueStrToJson(s[i].body);if(e&&l in e){let s=e[l];s=s.replace(", ",",").split(",");for(var n=0;n<s.length;n++)if(o.includes(s[n])){let i=t[s[n]];void 0==i&&(i=new Array),i.push(e),t[s[n]]=i}}}}}else for(e.group=[""],i=0;i<s.length;i++){let e=parseIssueStrToJson(s[i].body);if(e){let s=t[""];void 0==s&&(s=new Array),s.push(e),t[""]=s}}return t}function getIssuesAPIForSites(e){let s=$(e.el)[0];$(s).append('<div class="loading"><i class="fa fa-cog fa-2x fa-spin"></i><p>正在加载</p></div>'),requestIssuesAPI(e.api,function(t){$(s).find(".loading").remove();let i=groupIssuesData(e,t),n=Object.keys(i);e.group.forEach((e,t)=>{let a=i[e];if(a&&a.length>0)for(e.length>0?$(s).append("<h2>"+e+"</h2>"):""==name&&n.length>1&&$(s).append("<h2>未分组</h2>"),$(s).append('<div class="site-card-group '+t+'"></div>'),j=0;j<a.length;j++){let e=a[j],i="";i=e.screenshot&&e.screenshot.length>0?'<div class="img"><img src="'+e.screenshot+'" onerror="javascript:this.src=\'https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/052.jpg\';"/></div>':'<div class="img"></div>';let n='<div class="info">';e.avatar&&e.avatar.length>0&&(n+='<img src="'+e.avatar+'" onerror="javascript:this.src=\'https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/052.jpg\';"/>'),n+='<span class="title">'+e.title+'</span><span class="desc">'+e.description+"</span></div>";let l="<a class='site-card' target='_blank' href='"+e.url+"'>"+i+n+"</a>";$(s).find(".site-card-group."+t).append(l)}})},function(){$(s).find(".loading i").remove(),$(s).find(".loading p").text("加载失败，请稍后重试。")})}function getIssuesAPIForTimeline(e){let s=$(e.el)[0];$(s).append('<div class="loading"><i class="fa fa-cog fa-2x fa-spin"></i><p>正在加载</p></div>'),requestIssuesAPI(e.api,function(e){if($(s).find(".loading").remove(),e.length>0)for(i=0;i<e.length;i++){let t='&nbsp;&nbsp;<a class="comments" target="_blank" href="'+e[i].html_url+'"><i class="fa fa-comment-dots fa-fw"></i>'+e[i].comments+"</a>",n='<div class="timenode">'+('<div class="meta"><p></p><p>'+e[i].title+t+"</p><p></p></div>")+('<div class="body"><p>'+e[i].body+"</p></div>")+"</div>";$(s).append(n)}},function(){$(s).find(".loading i").remove(),$(s).find(".loading p").text("加载失败，请稍后重试。")})}function checkIssues(){let e=document.getElementsByClassName("issues-api");for(var s=0;s<e.length;s++){let i=e[s],n=i.getAttribute("api"),a=i.getAttribute("group");var t=new Object;t.class=i.getAttribute("class"),t.el=i,t.api=n,t.group=a,t.class.split(" ").includes("sites")?getIssuesAPIForSites(t):t.class.split(" ").includes("timeline")&&getIssuesAPIForTimeline(t)}}document.addEventListener("DOMContentLoaded",function(){checkIssues()}),document.addEventListener("pjax:complete",function(){checkIssues()});